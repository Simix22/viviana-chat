<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Chat with Viviana</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="quiz-polish.css">
    <link rel="stylesheet" href="chat-scroll-fix.css">
    <link rel="stylesheet" href="chat-photo-feature.css">
    <link rel="stylesheet" href="chat-footer-redesign.css">
    <link rel="stylesheet" href="critical-layout-fixes.css">
    <link rel="stylesheet" href="profile-credits-layout.css">
    <link rel="stylesheet" href="chat-layout-final-fix.css">
    <link rel="stylesheet" href="chat-rebuild.css">
    <link rel="stylesheet" href="audio-messaging.css">
</head>
<body>
    <!-- Welcome Screen -->
    <div id="welcomeScreen" class="screen">
        <div class="welcome-container">
            <div class="profile-image">
                <div class="avatar-placeholder">V</div>
            </div>
            <h1>Hey, you were invited by Viviana to chat with her.</h1>
            <p class="subtitle">Start a private conversation now</p>
            <button class="btn-primary" onclick="showAuth()">Get Started</button>
        </div>
    </div>

    <!-- Auth Screen -->
    <div id="authScreen" class="screen">
        <div class="auth-container">
            <button class="back-btn" onclick="showWelcome()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
            </button>

            <h2>Welcome Back</h2>
            <p class="auth-subtitle">Sign in to continue chatting with Viviana</p>

            <!-- Toggle between Login/Signup -->
            <div class="auth-toggle">
                <button class="toggle-btn active" id="loginTab" onclick="switchToLogin()">Login</button>
                <button class="toggle-btn" id="signupTab" onclick="switchToSignup()">Sign Up</button>
            </div>

            <!-- Login Form -->
            <form id="loginForm" class="auth-form active">
                <div class="input-group">
                    <label>Email</label>
                    <input type="email" id="loginEmail" placeholder="Enter your email" required>
                </div>
                <div class="input-group">
                    <label>Password</label>
                    <input type="password" id="loginPassword" placeholder="Enter your password" required>
                </div>
                <div style="text-align: right; margin-top: -10px; margin-bottom: 15px;">
                    <a href="javascript:void(0)" onclick="showPasswordResetScreen()" style="color: #E91E63; text-decoration: none; font-size: 14px;">Forgot Password?</a>
                </div>
                <button type="submit" class="btn-primary">Login</button>

                <div class="divider">
                    <span>or</span>
                </div>

                <button type="button" class="btn-google" onclick="handleGoogleLogin()">
                    <svg width="18" height="18" viewBox="0 0 18 18">
                        <path fill="#4285F4" d="M16.51 8H8.98v3h4.3c-.18 1-.74 1.48-1.6 2.04v2.01h2.6a7.8 7.8 0 0 0 2.38-5.88c0-.57-.05-.66-.15-1.18Z"/>
                        <path fill="#34A853" d="M8.98 17c2.16 0 3.97-.72 5.3-1.94l-2.6-2a4.8 4.8 0 0 1-7.18-2.54H1.83v2.07A8 8 0 0 0 8.98 17Z"/>
                        <path fill="#FBBC05" d="M4.5 10.52a4.8 4.8 0 0 1 0-3.04V5.41H1.83a8 8 0 0 0 0 7.18l2.67-2.07Z"/>
                        <path fill="#EA4335" d="M8.98 4.18c1.17 0 2.23.4 3.06 1.2l2.3-2.3A8 8 0 0 0 1.83 5.4L4.5 7.49a4.77 4.77 0 0 1 4.48-3.3Z"/>
                    </svg>
                    Continue with Google
                </button>
            </form>

            <!-- Signup Form -->
            <form id="signupForm" class="auth-form">
                <div class="input-group">
                    <label>Name</label>
                    <input type="text" id="signupName" placeholder="Enter your name" required>
                </div>
                <div class="input-group">
                    <label>Email</label>
                    <input type="email" id="signupEmail" placeholder="Enter your email" required>
                </div>
                <div class="input-group">
                    <label>Password</label>
                    <input type="password" id="signupPassword" placeholder="Create a password" required>
                </div>
                <button type="submit" class="btn-primary">Sign Up</button>

                <div class="divider">
                    <span>or</span>
                </div>

                <button type="button" class="btn-google" onclick="handleGoogleLogin()">
                    <svg width="18" height="18" viewBox="0 0 18 18">
                        <path fill="#4285F4" d="M16.51 8H8.98v3h4.3c-.18 1-.74 1.48-1.6 2.04v2.01h2.6a7.8 7.8 0 0 0 2.38-5.88c0-.57-.05-.66-.15-1.18Z"/>
                        <path fill="#34A853" d="M8.98 17c2.16 0 3.97-.72 5.3-1.94l-2.6-2a4.8 4.8 0 0 1-7.18-2.54H1.83v2.07A8 8 0 0 0 8.98 17Z"/>
                        <path fill="#FBBC05" d="M4.5 10.52a4.8 4.8 0 0 1 0-3.04V5.41H1.83a8 8 0 0 0 0 7.18l2.67-2.07Z"/>
                        <path fill="#EA4335" d="M8.98 4.18c1.17 0 2.23.4 3.06 1.2l2.3-2.3A8 8 0 0 0 1.83 5.4L4.5 7.49a4.77 4.77 0 0 1 4.48-3.3Z"/>
                    </svg>
                    Continue with Google
                </button>
            </form>
        </div>
    </div>

    <!-- Email Verification Screen -->
    <div id="verificationScreen" class="screen">
        <div class="auth-container">
            <button class="back-btn" onclick="showAuth()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
            </button>

            <div class="verification-icon">
                <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                    <polyline points="22,6 12,13 2,6"></polyline>
                </svg>
            </div>

            <h2>Check Your Email</h2>
            <p class="auth-subtitle">We've sent a verification link to <strong id="verificationEmail">your email</strong></p>

            <div class="verification-instructions">
                <p style="margin-top: 30px; margin-bottom: 20px; color: #666; line-height: 1.6;">
                    Please check your inbox and click the verification link to activate your account.
                    <br><br>
                    After verifying, return here and log in.
                </p>
            </div>

            <div class="verification-actions" style="margin-top: 30px;">
                <button type="button" class="btn-primary" onclick="showAuth()" style="margin-bottom: 15px;">
                    Back to Login
                </button>

                <div class="resend-section">
                    <p style="margin-bottom: 10px;">Didn't receive the email?</p>
                    <button type="button" class="btn-resend" id="resendVerificationBtn" onclick="resendVerificationEmail()">
                        Resend Verification Email
                    </button>
                    <p class="resend-timer" id="resendTimer" style="display: none; margin-top: 10px; color: #999;">
                        Resend available in <span id="timerSeconds">60</span>s
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Password Reset Screen -->
    <div id="passwordResetScreen" class="screen">
        <div class="auth-container">
            <button class="back-btn" onclick="showAuth()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
            </button>

            <div class="verification-icon">
                <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                </svg>
            </div>

            <h2>Reset Password</h2>
            <p class="auth-subtitle">Enter your email to receive a reset code</p>

            <form id="passwordResetRequestForm" class="auth-form">
                <div class="input-group">
                    <label>Email</label>
                    <input type="email" id="resetEmail" placeholder="Enter your email" required>
                </div>
                <button type="submit" class="btn-primary">Send Reset Code</button>
            </form>
        </div>
    </div>

    <!-- Password Reset Verification Screen -->
    <div id="passwordResetVerifyScreen" class="screen">
        <div class="auth-container">
            <button class="back-btn" onclick="showPasswordResetScreen()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
            </button>

            <div class="verification-icon">
                <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                    <polyline points="22,6 12,13 2,6"></polyline>
                </svg>
            </div>

            <h2>Enter Reset Code</h2>
            <p class="auth-subtitle">We've sent a 6-digit code to <strong id="resetEmailDisplay">your email</strong></p>

            <form id="passwordResetVerifyForm" class="verification-form">
                <div class="code-inputs">
                    <input type="text" maxlength="1" class="code-input reset-code-input" id="resetCode1" autofocus />
                    <input type="text" maxlength="1" class="code-input reset-code-input" id="resetCode2" />
                    <input type="text" maxlength="1" class="code-input reset-code-input" id="resetCode3" />
                    <input type="text" maxlength="1" class="code-input reset-code-input" id="resetCode4" />
                    <input type="text" maxlength="1" class="code-input reset-code-input" id="resetCode5" />
                    <input type="text" maxlength="1" class="code-input reset-code-input" id="resetCode6" />
                </div>

                <div class="verification-error" id="resetCodeError" style="display: none;"></div>

                <div class="input-group" style="margin-top: 20px;">
                    <label>New Password</label>
                    <input type="password" id="newPassword" placeholder="Enter new password" required minlength="6">
                </div>

                <div class="input-group">
                    <label>Confirm Password</label>
                    <input type="password" id="confirmPassword" placeholder="Confirm new password" required minlength="6">
                </div>

                <button type="submit" class="btn-primary">Reset Password</button>

                <div class="resend-section">
                    <p>Didn't receive the code?</p>
                    <button type="button" class="btn-resend" id="resendResetBtn" onclick="resendPasswordResetCode()">
                        Resend Code
                    </button>
                    <p class="resend-timer" id="resendResetTimer" style="display: none;">
                        Resend available in <span id="resetTimerSeconds">60</span>s
                    </p>
                </div>
            </form>
        </div>
    </div>

    <!-- Chat Screen -->
    <div id="chatScreen" class="screen">

        <!-- Profile Selection (Initial State) -->
        <div id="profileSelection" class="chat-state" style="display: flex;">
            <div class="profile-selection-container">
                <!-- Profile list dynamically rendered by profile-list-manager.js -->
            </div>
        </div>

        <!-- Quiz Flow -->
        <div id="quizFlow" class="chat-state" style="display: none;">
            <div class="quiz-container">
                <div class="quiz-header">
                    <button class="quiz-back-btn" onclick="backToProfileSelection()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 12H5M12 19l-7-7 7-7"/>
                        </svg>
                    </button>

                    <!-- Viviana Branding -->
                    <div class="quiz-branding">
                        <div class="quiz-branding-avatar">V</div>
                        <div class="quiz-branding-info">
                            <h3>Viviana <span style="color: #27ae60;">üíö</span></h3>
                            <p>Compatibility Check</p>
                        </div>
                    </div>

                    <div class="quiz-progress">
                        <div class="quiz-progress-text">
                            Question <span id="quizCurrentStep">1</span> / 6
                        </div>
                        <div class="quiz-progress-bar">
                            <div id="quizProgressFill" class="quiz-progress-fill" style="width: 16.666%"></div>
                        </div>
                        <!-- Progress Steps (Nodes) -->
                        <div class="quiz-progress-steps">
                            <div class="quiz-step current" data-step="1"></div>
                            <div class="quiz-step" data-step="2"></div>
                            <div class="quiz-step" data-step="3"></div>
                            <div class="quiz-step" data-step="4"></div>
                            <div class="quiz-step" data-step="5"></div>
                            <div class="quiz-step" data-step="6"></div>
                        </div>
                    </div>
                </div>

                <div class="quiz-content">
                    <div class="quiz-question-card">
                        <div class="quiz-avatar">
                            <div class="avatar-medium">V</div>
                        </div>
                        <h3 id="quizQuestion" class="quiz-question"></h3>
                        <div id="quizChoices" class="quiz-choices"></div>
                    </div>
                </div>

                <!-- Match Feedback Overlay -->
                <div id="matchFeedback" class="match-feedback" style="display: none;">
                    <div class="match-content">
                        <div class="match-icon">‚ú®</div>
                        <h3 class="match-text">Perfect Match!</h3>
                        <p class="match-subtext" id="matchSubtext">Viviana loves that too</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Unlock Success Modal -->
        <div id="unlockModal" class="chat-state unlock-modal" style="display: none;">
            <div class="unlock-modal-content">
                <canvas id="confettiCanvas" class="confetti-canvas"></canvas>
                <div class="unlock-card">
                    <div class="unlock-icon">üéâ</div>
                    <h2 class="unlock-title">Herzlichen Gl√ºckwunsch!</h2>
                    <p class="unlock-subtitle">Du bist freigeschaltet</p>
                    <div class="unlock-stats">
                        <div class="unlock-stat">
                            <div class="stat-number">6/6</div>
                            <div class="stat-label">Perfect Matches</div>
                        </div>
                        <div class="unlock-stat">
                            <div class="stat-number">100%</div>
                            <div class="stat-label">Compatibility</div>
                        </div>
                    </div>
                    <button class="unlock-cta" onclick="startChatWithViviana()">
                        <span>Start Chat mit Viviana</span>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="9 18 15 12 9 6"></polyline>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Actual Chat (Initially Hidden) -->
        <div id="actualChat" class="chat-state" style="display: none;">
            <!-- Chat Header -->
            <div class="chat-header">
                <div class="header-profile">
                    <div class="avatar-small">V</div>
                    <div class="header-info">
                        <h3>Viviana <span class="unlock-badge">‚úì</span></h3>
                        <span class="status">Online</span>
                    </div>
                </div>
                <!-- Credits display removed - now only in Settings menu -->
            </div>

            <!-- Open Quizzes List -->
            <div id="openQuizzesList" class="open-quizzes-list" style="display: none;">
                <!-- Dynamically populated by profile-quiz-system.js -->
            </div>

            <!-- Chat Messages -->
            <div class="chat-messages" id="chatMessages">
                <div class="message received">
                    <div class="message-avatar">V</div>
                    <div class="message-bubble">
                        <p>Hey! üëã So happy you're here! How are you doing today?</p>
                        <span class="message-time">Just now</span>
                    </div>
                </div>
            </div>

            <!-- Chat Input (3-Column Layout: Left Placeholder / Center Input / Right Actions) -->
            <div class="chat-input-container">
                <div class="chat-input-wrapper">
                    <!-- Left: Placeholder (reserved for future features) -->
                    <div class="chat-input-left">
                        <button class="menu-placeholder-btn" disabled title="More options (coming soon)">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="1"></circle>
                                <circle cx="12" cy="5" r="1"></circle>
                                <circle cx="12" cy="19" r="1"></circle>
                            </svg>
                        </button>
                    </div>

                    <!-- Center: Input Field (main focus, centered) -->
                    <div class="chat-input-center">
                        <button class="photo-btn" onclick="triggerPhotoUpload()" title="Send photo">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                <polyline points="21 15 16 10 5 21"></polyline>
                            </svg>
                        </button>

                        <button class="audio-btn" onclick="startAudioRecording()" title="Record voice message">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                                <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                                <line x1="12" y1="19" x2="12" y2="23"></line>
                                <line x1="8" y1="23" x2="16" y2="23"></line>
                            </svg>
                        </button>

                        <input type="text" id="messageInput" placeholder="Type a message..." />
                    </div>

                    <!-- Recording UI (replaces input during recording) -->
                    <div id="audioRecordingUI" class="audio-recording-ui">
                        <div class="recording-indicator">
                            <div class="recording-pulse"></div>
                            <span id="recordingTimer" class="recording-timer">0:00</span>
                        </div>
                        <div class="recording-waveform">
                            <div class="recording-bar"></div>
                            <div class="recording-bar"></div>
                            <div class="recording-bar"></div>
                            <div class="recording-bar"></div>
                            <div class="recording-bar"></div>
                        </div>
                        <div class="recording-actions">
                            <button class="recording-cancel-btn" onclick="cancelAudioRecording()" title="Cancel">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="18" y1="6" x2="6" y2="18"></line>
                                    <line x1="6" y1="6" x2="18" y2="18"></line>
                                </svg>
                            </button>
                            <button class="recording-send-btn" onclick="stopAudioRecording()" title="Send">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="22" y1="2" x2="11" y2="13"></line>
                                    <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- Right: Send Button -->
                    <div class="chat-input-right">
                        <button class="send-btn" onclick="sendMessage()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="22" y1="2" x2="11" y2="13"></line>
                                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                            </svg>
                        </button>
                    </div>

                    <!-- Hidden File Input -->
                    <input type="file" id="photoInput" accept="image/jpeg,image/png,image/webp" style="display: none;" onchange="handlePhotoSelect(event)" />
                </div>
            </div>
        </div>

        <!-- App Navigation -->
        <div class="app-nav">
            <button class="nav-item active" onclick="showChat()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                </svg>
                <span>Chat</span>
            </button>
            <button class="nav-item" onclick="showProfile()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                </svg>
                <span>Profile</span>
            </button>
        </div>
    </div>

    <!-- Credits Store Screen -->
    <div id="creditsScreen" class="screen">
        <div class="store-header">
            <button class="back-btn" onclick="showChat()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
            </button>
            <h2>Get More Credits</h2>
            <div class="current-balance">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <path d="M12 6v6l4 2"/>
                </svg>
                <span id="storeCreditsCount">3</span> credits
            </div>
        </div>

        <div class="store-container">
            <p class="store-subtitle">Choose a package and keep chatting with Viviana</p>

            <div class="credit-packages">
                <!-- Small Package -->
                <div class="credit-card">
                    <div class="card-badge">STARTER</div>
                    <div class="card-icon">
                        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                        </svg>
                    </div>
                    <h3>10 Credits</h3>
                    <p class="card-description">Perfect for casual conversations</p>
                    <div class="card-price">
                        <span class="price">$4.99</span>
                        <span class="price-per">$0.50 per credit</span>
                    </div>
                    <button class="btn-purchase" onclick="purchaseCredits(10, 4.99, 'Small')">Purchase</button>
                </div>

                <!-- Medium Package - Popular -->
                <div class="credit-card popular">
                    <div class="card-badge popular-badge">MOST POPULAR</div>
                    <div class="card-icon">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <circle cx="12" cy="12" r="6"/>
                        </svg>
                    </div>
                    <h3>25 Credits</h3>
                    <p class="card-description">Best value for regular chatters</p>
                    <div class="card-price">
                        <span class="price">$9.99</span>
                        <span class="price-per">$0.40 per credit</span>
                    </div>
                    <div class="savings-badge">Save 20%</div>
                    <button class="btn-purchase" onclick="purchaseCredits(25, 9.99, 'Medium')">Purchase</button>
                </div>

                <!-- Large Package -->
                <div class="credit-card">
                    <div class="card-badge">PREMIUM</div>
                    <div class="card-icon">
                        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <circle cx="12" cy="12" r="6"/>
                            <circle cx="12" cy="12" r="2"/>
                        </svg>
                    </div>
                    <h3>50 Credits</h3>
                    <p class="card-description">Unlimited conversations anytime</p>
                    <div class="card-price">
                        <span class="price">$14.99</span>
                        <span class="price-per">$0.30 per credit</span>
                    </div>
                    <div class="savings-badge">Save 40%</div>
                    <button class="btn-purchase" onclick="purchaseCredits(50, 14.99, 'Large')">Purchase</button>
                </div>
            </div>

            <div class="store-footer">
                <p><strong>üí≥ Secure Payment</strong> ¬∑ All transactions are encrypted</p>
                <p><strong>‚ö° Instant Delivery</strong> ¬∑ Credits added immediately</p>
            </div>
        </div>

        <!-- App Navigation -->
        <div class="app-nav">
            <button class="nav-item" onclick="showChat()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                </svg>
                <span>Chat</span>
            </button>
            <button class="nav-item active">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="12" y1="8" x2="12" y2="12"></line>
                    <line x1="12" y1="16" x2="12.01" y2="16"></line>
                </svg>
                <span>Credits</span>
            </button>
            <button class="nav-item" onclick="showProfile()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                </svg>
                <span>Profile</span>
            </button>
        </div>
    </div>

    <!-- Profile Screen -->
    <div id="profileScreen" class="screen">
        <div class="profile-header">
            <button class="back-btn" onclick="showChat()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
            </button>
            <h2>My Profile</h2>
        </div>

        <div class="profile-container">
            <!-- Profile Picture Section -->
            <div class="profile-picture-section">
                <div class="profile-picture-wrapper">
                    <div class="profile-picture" id="profilePicture">
                        <span id="profileInitial">U</span>
                    </div>
                    <button class="edit-picture-btn" onclick="uploadProfilePicture()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                            <circle cx="12" cy="13" r="4"></circle>
                        </svg>
                    </button>
                </div>
                <p class="profile-hint">Tap the camera icon to upload a photo</p>
            </div>

            <!-- Profile Info Form -->
            <form id="profileForm" class="profile-form">
                <div class="input-group">
                    <label>Name</label>
                    <input type="text" id="profileName" placeholder="Your name" required>
                </div>

                <div class="input-group">
                    <label>Email</label>
                    <input type="email" id="profileEmail" placeholder="Your email" disabled>
                    <span class="input-hint">Email cannot be changed</span>
                </div>

                <div class="input-group">
                    <label>Bio</label>
                    <textarea id="profileBio" placeholder="Tell Viviana about yourself..." rows="3"></textarea>
                </div>

                <button type="submit" class="btn-primary">Save Changes</button>
            </form>

            <!-- Credits Section - Prominent -->
            <div class="profile-credits-section">
                <div class="credits-balance">
                    <div class="credits-amount">
                        <div class="credits-icon">üíé</div>
                        <div>
                            <span class="credits-number" id="profileCreditsCount">3</span>
                            <span class="credits-label">Credits</span>
                        </div>
                    </div>
                </div>
                <button class="credits-buy-btn" onclick="showCreditsStore()">
                    <span class="credits-buy-icon">‚ú®</span>
                    <span>Get More Credits</span>
                </button>
            </div>

            <!-- Additional Options -->
            <div class="profile-options">
                <h3>Account Settings</h3>

                <button class="option-btn" onclick="showNotificationSettings()">
                    <div class="option-content">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                        </svg>
                        <span>Notification Settings</span>
                    </div>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                </button>

                <button class="option-btn" onclick="showPrivacySettings()">
                    <div class="option-content">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                        </svg>
                        <span>Privacy Settings</span>
                    </div>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                </button>

                <button class="option-btn" onclick="deleteAccount()">
                    <div class="option-content">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#F44336" stroke-width="2">
                            <polyline points="3 6 5 6 21 6"></polyline>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                            <line x1="10" y1="11" x2="10" y2="17"></line>
                            <line x1="14" y1="11" x2="14" y2="17"></line>
                        </svg>
                        <span style="color: #F44336;">Delete Account</span>
                    </div>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#F44336" stroke-width="2">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                </button>

                <button class="option-btn" onclick="logout()">
                    <div class="option-content">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                            <polyline points="16 17 21 12 16 7"></polyline>
                            <line x1="21" y1="12" x2="9" y2="12"></line>
                        </svg>
                        <span>Logout</span>
                    </div>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                </button>
            </div>
        </div>

        <!-- App Navigation -->
        <div class="app-nav">
            <button class="nav-item" onclick="showChat()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                </svg>
                <span>Chat</span>
            </button>
            <button class="nav-item active">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                </svg>
                <span>Profile</span>
            </button>
        </div>
    </div>

    <!-- Notification Settings Screen -->
    <div id="notificationSettingsScreen" class="screen">
        <div class="profile-header">
            <button class="back-btn" onclick="showProfile()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
            </button>
            <h2>Notification Settings</h2>
        </div>

        <div class="settings-container">
            <div class="settings-section">
                <h3>Push Notifications</h3>
                <p class="settings-hint">Manage how you receive notifications</p>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                            </svg>
                        </div>
                        <div>
                            <strong>New Messages</strong>
                            <p>Get notified when Viviana responds to your messages</p>
                        </div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="notifyNewMessages" onchange="saveNotificationSettings()">
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <line x1="12" y1="8" x2="12" y2="12"></line>
                                <line x1="12" y1="16" x2="12.01" y2="16"></line>
                            </svg>
                        </div>
                        <div>
                            <strong>Credits Updates</strong>
                            <p>Notifications about credit purchases and balance changes</p>
                        </div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="notifyCredits" onchange="saveNotificationSettings()">
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                                <polyline points="22,6 12,13 2,6"></polyline>
                            </svg>
                        </div>
                        <div>
                            <strong>Email Notifications</strong>
                            <p>Receive updates and important information via email</p>
                        </div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="notifyEmail" onchange="saveNotificationSettings()">
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                                <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
                            </svg>
                        </div>
                        <div>
                            <strong>Product Updates</strong>
                            <p>News about new features and improvements</p>
                        </div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="notifyProductUpdates" onchange="saveNotificationSettings()">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>

            <p class="settings-footer-note">
                Changes are saved automatically. You can update these settings anytime.
            </p>
        </div>
    </div>

    <!-- Privacy Settings Screen -->
    <div id="privacySettingsScreen" class="screen">
        <div class="profile-header">
            <button class="back-btn" onclick="showProfile()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
            </button>
            <h2>Privacy Settings</h2>
        </div>

        <div class="settings-container">
            <div class="settings-section">
                <h3>Profile Visibility</h3>
                <p class="settings-hint">Control who can see your profile information</p>

                <div class="radio-group">
                    <label class="radio-option">
                        <input type="radio" name="profileVisibility" value="private" onchange="savePrivacySettings()">
                        <div class="radio-content">
                            <div class="radio-check"></div>
                            <div>
                                <strong>Private</strong>
                                <p>Only you can see your profile details</p>
                            </div>
                        </div>
                    </label>

                    <label class="radio-option">
                        <input type="radio" name="profileVisibility" value="public" onchange="savePrivacySettings()">
                        <div class="radio-content">
                            <div class="radio-check"></div>
                            <div>
                                <strong>Public</strong>
                                <p>Your profile is visible to other users</p>
                            </div>
                        </div>
                    </label>
                </div>
            </div>

            <div class="settings-section">
                <h3>Data & Analytics</h3>
                <p class="settings-hint">Help us improve Viviana</p>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                            </svg>
                        </div>
                        <div>
                            <strong>Usage Analytics</strong>
                            <p>Allow anonymous usage data to improve the app</p>
                        </div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="allowAnalytics" onchange="savePrivacySettings()">
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                <polyline points="22 4 12 14.01 9 11.01"></polyline>
                            </svg>
                        </div>
                        <div>
                            <strong>Show Verified Badge</strong>
                            <p>Display verification badge on your profile (if verified)</p>
                        </div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="showVerifiedBadge" onchange="savePrivacySettings()">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>

            <p class="settings-footer-note">
                Your privacy is important. These settings are saved locally and can be changed at any time.
            </p>
        </div>
    </div>

    <!-- Verification Popup -->
    <div id="verificationPopup" class="popup-overlay">
        <div class="popup-content">
            <button class="popup-close" onclick="closeVerification()">√ó</button>
            <div class="popup-icon">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#4CAF50" stroke-width="2">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                </svg>
            </div>
            <h3>Get Verified</h3>
            <p>Verify yourself with a photo to get the green checkmark and unlock exclusive features.</p>
            <button class="btn-primary" onclick="attemptVerification()">Upload Photo</button>
            <button class="btn-secondary" onclick="closeVerification()">Maybe Later</button>
        </div>
    </div>

    <!-- Purchase Success Popup -->
    <div id="purchaseSuccessPopup" class="popup-overlay">
        <div class="popup-content success-popup">
            <div class="success-animation">
                <div class="success-checkmark">
                    <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="#4CAF50" stroke-width="2">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                        <polyline points="22 4 12 14.01 9 11.01"></polyline>
                    </svg>
                </div>
                <div class="success-confetti">
                    <div class="confetti"></div>
                    <div class="confetti"></div>
                    <div class="confetti"></div>
                    <div class="confetti"></div>
                    <div class="confetti"></div>
                </div>
            </div>
            <h3>Purchase Successful!</h3>
            <p id="purchaseMessage">25 credits have been added to your account</p>
            <div class="new-balance">
                <span>New Balance:</span>
                <strong id="newBalanceDisplay">28 credits</strong>
            </div>
            <button class="btn-primary" onclick="closePurchaseSuccess()">Start Chatting</button>
        </div>
    </div>

    <!-- Delete Account Confirmation Modal -->
    <div id="deleteAccountModal" class="popup-overlay">
        <div class="popup-content delete-confirm-popup">
            <div class="popup-icon warning">
                <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#F44336" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="8" x2="12" y2="12"></line>
                    <line x1="12" y1="16" x2="12.01" y2="16"></line>
                </svg>
            </div>
            <h3>Delete Account?</h3>
            <p>Are you absolutely sure you want to delete your account? This action cannot be undone.</p>
            <div class="warning-box">
                <strong>‚ö†Ô∏è Warning:</strong>
                <ul>
                    <li>All your messages will be deleted</li>
                    <li>Your credits will be lost</li>
                    <li>Your profile data will be permanently removed</li>
                </ul>
            </div>
            <div class="modal-actions">
                <button class="btn-modal-cancel" onclick="closeDeleteConfirm()">Cancel</button>
                <button class="btn-modal-danger" onclick="confirmDeleteAccount()">Yes, Delete My Account</button>
            </div>
        </div>
    </div>

    <!-- Error/Info Toast -->
    <div id="toast" class="toast"></div>

    <!-- Image Lightbox Modal -->
    <div id="imageLightbox" class="lightbox-overlay" onclick="closeLightbox()" style="display: none;">
        <div class="lightbox-content" onclick="event.stopPropagation()">
            <button class="lightbox-close" onclick="closeLightbox()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
            <img id="lightboxImage" src="" alt="Full size image" />
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-storage-compat.js"></script>

    <script src="script.js"></script>
    <script src="quiz-polish.js"></script>
    <script src="chat-scroll-fix.js"></script>
    <script src="chat-photo-feature.js"></script>
    <script src="quiz-modal-fix.js"></script>
    <script src="profile-quiz-system.js"></script>
    <script src="profile-list-manager.js"></script>
    <script src="credits-display.js"></script>
    <script src="audio-messaging.js"></script>
</body>
</html>
